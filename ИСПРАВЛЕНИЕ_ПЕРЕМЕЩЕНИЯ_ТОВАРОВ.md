# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤

## üö® **–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É —É —Ç–æ–≤–∞—Ä–∞ –∏–∑ –≥—Ä—É–ø–ø—ã "–í–∞–∂–Ω–æ" (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–Ø–π—Ü–∞") –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Å–ª—É—á–∞–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –≥—Ä—É–ø–ø—ã "–û—Å—Ç–∞–ª—å–Ω–æ–µ" –≤ –≥—Ä—É–ø–ø—É "–í–∞–∂–Ω–æ".

## üêõ **–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã**

### **–î–≤–æ–π–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞:**
```kotlin
// –ü–†–û–ë–õ–ï–ú–ù–´–ô –ö–û–î:
runOnUiThread {
    adapter.notifyDataSetChanged()  // ‚Üê –ü–µ—Ä–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    updateListAndSave()          // ‚Üê –í—Ç–æ—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
1. `notifyDataSetChanged()` –∑–∞—Å—Ç–∞–≤–ª—è–ª RecyclerView –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
2. `updateListAndSave()` –≤—ã–∑—ã–≤–∞–ª `submitList()` —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. DiffUtil –ø–æ–ª—É—á–∞–ª –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞–ª —ç–ª–µ–º–µ–Ω—Ç—ã

## ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**

### **–£–±—Ä–∞–Ω–æ –¥–≤–æ–π–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
```kotlin
// –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î:
runOnUiThread {
    updateListAndSave()  // –¢–æ–ª—å–∫–æ –æ–¥–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
}
```

### **–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```kotlin
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –î–û –∏–∑–º–µ–Ω–µ–Ω–∏—è
val beforeState = productManager.products.map { "${it.name}:urgent=${it.isUrgent},buy=${it.needsToBuy}" }
FileLogger.d("MAIN_ACTIVITY", "BEFORE STATE ALL: $beforeState")

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è
val afterState = productManager.products.map { "${it.name}:urgent=${it.isUrgent},buy=${it.needsToBuy}" }
FileLogger.d("MAIN_ACTIVITY", "AFTER STATE ALL: $afterState")
```

## üß™ **–ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

### **–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**
1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º
2. **–£–±–µ–¥–∏—Ç–µ—Å—å**, —á—Ç–æ –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
   - üî• –°–†–û–ß–ù–û: –ú–æ–ª–æ–∫–æ, –•–ª–µ–±
   - üõí –í–ê–ñ–ù–û: –Ø–π—Ü–∞, –°–æ–ª—å, –°–∞—Ö–∞—Ä, –ú–∞—Å–ª–æ, –ö–æ—Ñ–µ, –ß–∞–π
   - üìã –û–°–¢–ê–õ–¨–ù–û–ï: –ú–∞–∫–∞—Ä–æ–Ω—ã, –†–∏—Å, –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å, –õ—É–∫, –ú–æ—Ä–∫–æ–≤—å, –ö—É—Ä–∏—Ü–∞, –°—ã—Ä, –ô–æ–≥—É—Ä—Ç, –¢–≤–æ—Ä–æ–≥, –ö–æ–ª–±–∞—Å–∞, –°–æ—Å–∏—Å–∫–∏, –•–ª–µ–±—Ü—ã, –®–æ–∫–æ–ª–∞–¥, –ü–µ—á–µ–Ω—å–µ, –ö–æ–Ω—Ñ–µ—Ç—ã, –í–æ–¥–∞, –°–æ–∫

### **–®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ "–Ø–π—Ü–∞"**
1. **–ù–∞–π–¥–∏—Ç–µ —Ç–æ–≤–∞—Ä "–Ø–π—Ü–∞"** –≤ –≥—Ä—É–ø–ø–µ "üõí –í–ê–ñ–ù–û"
2. **–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É** —Ä—è–¥–æ–º —Å "–Ø–π—Ü–∞"
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - "–Ø–π—Ü–∞" –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –≤ –≥—Ä—É–ø–ø—É "üî• –°–†–û–ß–ù–û"
   - –ó–≤–µ–∑–¥–æ—á–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ç—å —è—Ä–∫–æ–π (alpha=1.0)
   - –§–æ–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–º
   - **–ù–ò–ö–ê–ö–ò–ï –î–†–£–ì–ò–ï –¢–û–í–ê–†–´** –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è!

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**
–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
# –ò—â–µ–º –ª–æ–≥–∏ –¥–ª—è "–Ø–π—Ü–∞"
grep -A 15 -B 5 "TOGGLE URGENCY.*–Ø–π—Ü–∞" logs/debug_v*.log

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
grep -A 5 -B 5 "STATE ALL" logs/debug_v*.log
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
[TIME] MAIN_ACTIVITY: === TOGGLE URGENCY: –Ø–π—Ü–∞ ===
[TIME] MAIN_ACTIVITY: BEFORE: urgent=false, buy=true
[TIME] MAIN_ACTIVITY: BEFORE STATE ALL: [..., –Ø–π—Ü–∞:urgent=false,buy=true, –ú–∞–∫–∞—Ä–æ–Ω—ã:urgent=false,buy=false, ...]
[TIME] PRODUCT_MANAGER: === TOGGLE URGENCY: –Ø–π—Ü–∞ ===
[TIME] PRODUCT_MANAGER: AFTER: urgent=true, buy=true
[TIME] MAIN_ACTIVITY: AFTER STATE ALL: [..., –Ø–π—Ü–∞:urgent=true,buy=true, –ú–∞–∫–∞—Ä–æ–Ω—ã:urgent=false,buy=false, ...]
[TIME] MAIN_ACTIVITY: AFTER: urgent=true, buy=true
```

**–í–ê–ñ–ù–û:** –í—Å–µ —Ç–æ–≤–∞—Ä—ã –∫—Ä–æ–º–µ "–Ø–π—Ü–∞" –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å **–¢–ï–• –ñ–ï –°–û–°–¢–û–Ø–ù–ò–Ø** –¥–æ –∏ –ø–æ—Å–ª–µ!

### **–®–∞–≥ 4: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**
1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã** –∏–∑ "–í–∞–∂–Ω–æ":
   - –°–æ–ª—å ‚Üí –°—Ä–æ—á–Ω–æ
   - –°–∞—Ö–∞—Ä ‚Üí –°—Ä–æ—á–Ω–æ
   - –ú–∞—Å–ª–æ ‚Üí –°—Ä–æ—á–Ω–æ

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ:**
   - –Ø–π—Ü–∞ (—É–∂–µ –≤ –°—Ä–æ—á–Ω–æ) ‚Üí –û–±—ã—á–Ω—ã–π
   - –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ "–í–∞–∂–Ω–æ"

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏:**
   - –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã

## üéØ **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
–ù–∞–∂–∞—Ç–∏–µ –Ω–∞ "–Ø–π—Ü–∞" ‚Üí –Ø–π—Ü–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –°–†–û–ß–ù–û
–ù–û: –ú–∞–∫–∞—Ä–æ–Ω—ã, –†–∏—Å, –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –≤ –í–ê–ñ–ù–û ‚ùå
```

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
–ù–∞–∂–∞—Ç–∏–µ –Ω–∞ "–Ø–π—Ü–∞" ‚Üí –Ø–π—Ü–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –°–†–û–ß–ù–û
–ò: –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –º–µ—Å—Ç–∞—Ö ‚úÖ
```

## üìä **–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤**

### **–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:**

#### **1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```bash
grep -E "(BEFORE STATE ALL|AFTER STATE ALL)" logs/debug_v*.log
```
**–í—Å–µ —Ç–æ–≤–∞—Ä—ã –∫—Ä–æ–º–µ –∏–∑–º–µ–Ω—è–µ–º–æ–≥–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏!**

#### **2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π:**
```bash
grep -A 20 "–ì–†–£–ü–ü–´ –ü–û–°–õ–ï –ì–†–£–ü–ü–ò–†–û–í–ö–ò" logs/debug_v*.log
```
**–¢–æ–≤–∞—Ä—ã –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ —Å–≤–æ–∏—Ö –≥—Ä—É–ø–ø–∞—Ö.**

#### **3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ DiffUtil:**
```bash
grep -A 5 -B 5 "areContentsTheSame" logs/debug_v*.log
```
**–¢–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å `areContentsTheSame RESULT: false`**

## üö® **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å**

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. **–ù–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `notifyDataSetChanged()`** –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö
2. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç `submitList()`** –≤ `updateListAndSave()`
3. **–ù–µ—Ç –ª–∏ –≥–æ–Ω–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π** –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å, –¥–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `updateListAndSave()`:
```kotlin
private fun updateListAndSave() {
    recyclerView.post {
        val beforeList = adapter.currentList
        val groupedList = productManager.getGroupedList()
        FileLogger.d("UPDATE_LIST", "BEFORE: $beforeList")
        FileLogger.d("UPDATE_LIST", "AFTER: $groupedList")
        
        adapter.submitList(groupedList)
        dataManager.saveProducts(productManager.products)
    }
}
```

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

**‚úÖ –£–±—Ä–∞–Ω–æ –¥–≤–æ–π–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞**
**‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π**
**‚úÖ –û–±–µ—Å–ø–µ—á–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ DiffUtil**
**‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ —Å–ª—É—á–∞–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤**

---

**–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É —É –ª—é–±–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ—é –≥—Ä—É–ø–ø—É –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã!**
