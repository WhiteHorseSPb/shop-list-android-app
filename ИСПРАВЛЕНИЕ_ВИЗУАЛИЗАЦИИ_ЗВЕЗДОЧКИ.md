# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–≤–µ–∑–¥–æ—á–∫–∏ –∏ —Ñ–æ–Ω–∞

## üö® **–ü—Ä–æ–±–ª–µ–º–∞**

–¢–æ–≤–∞—Ä –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É "–°—Ä–æ—á–Ω–æ", –Ω–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è:
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–æ–≤–∞—Ä –≤ "–°—Ä–æ—á–Ω–æ")
- ‚ùå –ó–≤–µ–∑–¥–æ—á–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π (alpha=0.4)
- ‚ùå –§–æ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º (–Ω–µ –∫—Ä–∞—Å–Ω—ã–π)

## üîç **–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã**

### **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å DiffUtil:**
1. `DiffUtil` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–µ—Ç `payloads`
2. `onBindViewHolder()` —Å `payloads` –≤—ã–∑—ã–≤–∞–µ—Ç `updateUrgency()`
3. –ù–æ `updateUrgency()` –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. MIUI –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫—ç—à–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ View

## ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**

### **1. –£—Å–∏–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ProductAdapter:**
```kotlin
fun bind(product: Product, ...) {
    FileLogger.d("PRODUCT_ADAPTER", "=== BIND: ${product.name} ===")
    FileLogger.d("PRODUCT_ADAPTER", "INPUT DATA: urgent=${product.isUrgent}, buy=${product.needsToBuy}")
    
    // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    updateVisualElements(product)
}

private fun updateVisualElements(product: Product) {
    // –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è MIUI
    // –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
}
```

### **2. –£–ª—É—á—à–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å payload:**
```kotlin
override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int, payloads: MutableList<Any>) {
    if (payloads.isEmpty()) {
        // –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞
        (holder as ProductViewHolder).bind(item, onProductChanged, onProductLongClick)
    } else {
        // –¢–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ updateUrgency()
        payloads.forEach { payload ->
            when (payload) {
                "urgency_changed" -> (holder as ProductViewHolder).updateUrgency(item)
            }
        }
    }
}
```

### **3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è MIUI:**
```kotlin
private fun updateVisualElements(product: Product) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    urgentStar.alpha = if (isUrgent) 1.0f else 0.4f
    urgentStar.setImageResource(if (isUrgent) android.R.drawable.btn_star_big_on else android.R.drawable.btn_star_big_off)
    itemView.setBackgroundResource(if (isUrgent) R.color.urgent_background else R.drawable.product_item_background)
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è MIUI
    itemView.post {
        itemView.invalidate()
        urgentStar.invalidate()
        switchBuy.invalidate()
    }
}
```

## üß™ **–ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

### **–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**
1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º
2. **–£–±–µ–¥–∏—Ç–µ—Å—å** –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
   - üî• –°–†–û–ß–ù–û: –ú–æ–ª–æ–∫–æ, –•–ª–µ–± (—è—Ä–∫–∏–µ –∑–≤–µ–∑–¥–æ—á–∫–∏, –∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω)
   - üõí –í–ê–ñ–ù–û: –Ø–π—Ü–∞, –°–æ–ª—å, –°–∞—Ö–∞—Ä, –ú–∞—Å–ª–æ, –ö–æ—Ñ–µ, –ß–∞–π (–ø–†–û–ó–†–ê–ß–ù–´–ï –∑–≤–µ–∑–¥–æ—á–∫–∏, –æ–±—ã—á–Ω—ã–π —Ñ–æ–Ω)
   - üìã –û–°–¢–ê–õ–¨–ù–û–ï: –ú–∞–∫–∞—Ä–æ–Ω—ã, –†–∏—Å, –ö–∞—Ä—Ç–æ—Ñ–µ–ª—å... (–ø–†–û–ó–†–ê–ß–ù–´–ï –∑–≤–µ–∑–¥–æ—á–∫–∏, –æ–±—ã—á–Ω—ã–π —Ñ–æ–Ω)

### **–®–∞–≥ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ "–Ø–π—Ü–∞"**
1. **–ù–∞–π–¥–∏—Ç–µ "–Ø–π—Ü–∞"** –≤ –≥—Ä—É–ø–ø–µ "üõí –í–ê–ñ–ù–û"
2. **–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É** —Ä—è–¥–æ–º —Å "–Ø–π—Ü–∞"
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - "–Ø–π—Ü–∞" –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ "üî• –°–†–û–ß–ù–û"
   - –ó–≤–µ–∑–¥–æ—á–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ø–†–ö–û–ô (alpha=1.0)
   - –§–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ö–†–ê–°–ù–´–ú
   - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ (needsToBuy=true)

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**
```bash
# –ò—â–µ–º –ª–æ–≥–∏ –¥–ª—è "–Ø–π—Ü–∞"
grep -A 20 -B 5 "–Ø–π—Ü–∞" logs/debug_v*.log

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
grep -A 10 -B 2 "VISUAL STATE" logs/debug_v*.log
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
[TIME] PRODUCT_ADAPTER: === BIND: –Ø–π—Ü–∞ ===
[TIME] PRODUCT_ADAPTER: INPUT DATA: urgent=false, buy=true
[TIME] PRODUCT_ADAPTER: UPDATE VISUAL: urgent=false, buy=true
[TIME] PRODUCT_ADAPTER: VISUAL STATE: star_alpha=0.4, star_src=btn_star_big_off, bg=product_item_background

[TIME] MAIN_ACTIVITY: === TOGGLE URGENCY: –Ø–π—Ü–∞ ===
[TIME] PRODUCT_MANAGER: AFTER: urgent=true, buy=true

[TIME] PRODUCT_ADAPTER: === UPDATE URGENCY: –Ø–π—Ü–∞ ===
[TIME] PRODUCT_ADAPTER: INPUT: urgent=true, buy=true
[TIME] PRODUCT_ADAPTER: UPDATE VISUAL: urgent=true, buy=true
[TIME] PRODUCT_ADAPTER: VISUAL STATE: star_alpha=1.0, star_src=btn_star_big_on, bg=urgent_background
```

### **–®–∞–≥ 4: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**
1. **–û–±—Ä–∞—Ç–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ:**
   - "–Ø–π—Ü–∞" (—É–∂–µ –≤ –°—Ä–æ—á–Ω–æ) ‚Üí –û–±—ã—á–Ω—ã–π
   - –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ "–í–∞–∂–Ω–æ"
   - –ó–≤–µ–∑–¥–æ—á–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π
   - –§–æ–Ω –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å –æ–±—ã—á–Ω—ã–º

2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:**
   - –Ø–π—Ü–∞ ‚Üí –°—Ä–æ—á–Ω–æ ‚Üí –û–±—ã—á–Ω—ã–π ‚Üí –°—Ä–æ—á–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

3. **–ë—ã—Å—Ç—Ä—ã–µ –Ω–∞–∂–∞—Ç–∏—è:**
   - –ë—ã—Å—Ç—Ä–æ–µ –¥–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É
   - –ù–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –æ—à–∏–±–∫–∞–º

## üéØ **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
–ù–∞–∂–∞—Ç–∏–µ –Ω–∞ "–Ø–π—Ü–∞" ‚Üí –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –°–†–û–ß–ù–û
–ù–û: –ó–≤–µ–∑–¥–æ—á–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π ‚ùå
–ù–û: –§–æ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º ‚ùå
```

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
–ù–∞–∂–∞—Ç–∏–µ –Ω–∞ "–Ø–π—Ü–∞" ‚Üí –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –°–†–û–ß–ù–û
–ò: –ó–≤–µ–∑–¥–æ—á–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Ä–∫–æ–π ‚úÖ
–ò: –§–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–º ‚úÖ
–ò: –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤–ø—Ä–∞–≤–æ ‚úÖ
```

## üìä **–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤**

### **–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:**

#### **1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**
```bash
grep -A 5 "INPUT DATA" logs/debug_v*.log
```
**–î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞.**

#### **2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:**
```bash
grep -A 5 "VISUAL STATE" logs/debug_v*.log
```
**–î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ alpha –∏ background.**

#### **3. –†–∞–±–æ—Ç–∞ DiffUtil:**
```bash
grep -A 5 "urgency_changed" logs/debug_v*.log
```
**–î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É payload.**

## üö® **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å**

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. **–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `updateVisualElements()`** –≤ `updateUrgency()`
2. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç** `invalidate()` –¥–ª—è MIUI
3. **–ù–µ—Ç –ª–∏ –∑–∞–¥–µ—Ä–∂–µ–∫** –≤ `itemView.post {}`

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
```kotlin
fun updateUrgency(product: Product) {
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
    updateVisualElements(product)
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞
    itemView.requestLayout()
    itemView.postDelayed({
        itemView.invalidate()
        urgentStar.invalidate()
    }, 50) // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è MIUI
}
```

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

**‚úÖ –£—Å–∏–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ ProductAdapter**
**‚úÖ –°–æ–∑–¥–∞–Ω –µ–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ `updateVisualElements()`**
**‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å DiffUtil –∏ payloads**
**‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è MIUI**
**‚úÖ –û–±–µ—Å–ø–µ—á–µ–Ω–æ –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤**

---

**–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É —Ç–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –≤ –Ω—É–∂–Ω—É—é –≥—Ä—É–ø–ø—É –° –≤–∏–∑—É–∞–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏ –∏ —Ñ–æ–Ω–∞!**
